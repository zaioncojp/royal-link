<section class="urls-section">
  <div class="card">
    <div class="card-header">
      <h2><i class="fas fa-chart-line"></i> 短縮URL一覧</h2>
    </div>
    <div class="card-body">
      <% if (urls && urls.length > 0) { %>
        <!-- タブ -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="list">リスト表示</button>
          <button class="tab-btn" data-tab="analytics">アクセス統計</button>
        </div>
        
        <!-- URL一覧タブ -->
        <div id="list-tab" class="tab-panel active">
          <div class="url-list">
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>元URL</th>
                    <th>短縮URL</th>
                    <th>クリック数</th>
                    <th>作成日</th>
                    <th>アクション</th>
                  </tr>
                </thead>
                <tbody>
                  <% for (let i = 0; i < urls.length; i++) { %>
                    <tr>
                      <td class="original-url" title="<%= urls[i].originalUrl %>">
                        <%= urls[i].originalUrl.length > 30 ? urls[i].originalUrl.substring(0, 30) + '...' : urls[i].originalUrl %>
                      </td>
                      <td>
                        <% if (urls[i].customSlug) { %>
                          <a href="https://<%= appDomain %>/<%= urls[i].customSlug %>" target="_blank">
                            <%= appDomain %>/<%= urls[i].customSlug %>
                          </a>
                        <% } else { %>
                          <a href="https://<%= appDomain %>/s/<%= urls[i].shortCode %>" target="_blank">
                            <%= appDomain %>/s/<%= urls[i].shortCode %>
                          </a>
                        <% } %>
                      </td>
                      <td><%= urls[i].clicks %></td>
                      <td><%= new Date(urls[i].createdAt).toLocaleDateString() %></td>
                      <td>
                        <div class="action-buttons">
                          <a href="/urls/delete/<%= urls[i]._id %>" class="btn-small btn-danger" title="削除" onclick="return confirm('このURLを削除してもよろしいですか？');">
                            <i class="fas fa-trash"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- アクセス統計タブ -->
        <div id="analytics-tab" class="tab-panel">
          <div class="analytics-chart">
            <h3>クリック数の推移</h3>
            <div class="chart-container">
              <% 
                // クリック数の多い順にソート
                const sortedUrls = [...urls].sort((a, b) => b.clicks - a.clicks).slice(0, 10);
                const maxClicks = Math.max(...sortedUrls.map(url => url.clicks || 0), 1);
              %>
              
              <% for (let i = 0; i < sortedUrls.length; i++) { %>
                <div class="chart-bar">
                  <div class="bar" style="height: <%= Math.max(20, ((sortedUrls[i].clicks || 0) / maxClicks) * 250) %>px">
                    <span class="clicks"><%= sortedUrls[i].clicks || 0 %></span>
                  </div>
                  <span class="code"><%= sortedUrls[