<!DOCTYPE html>
<html lang="ja">
<%- include('partials/header') %>
<body>
  <!-- 背景装飾 -->
  <div class="bg-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="dashboard-container">
    <!-- サイドバー -->
    <%- include('partials/sidebar', { user: user }) %>

    <!-- メインコンテンツ -->
    <div class="main-content">
      <header class="top-bar">
        <h1>ダッシュボード</h1>
      </header>

      <!-- アラート -->
      <% if (error) { %>
        <div class="alert alert-error">
          <i class="fas fa-exclamation-circle"></i> <%= error %>
        </div>
      <% } %>
      
      <% if (success) { %>
        <div class="alert alert-success">
          <i class="fas fa-check-circle"></i> <%= success %>
        </div>
      <% } %>

      <!-- URL作成セクション -->
      <%- include('partials/url-form', { domains: domains, appDomain: appDomain }) %>
      
      <!-- ドメイン一覧 -->
      <%- include('partials/domains-list', { domains: domains }) %>
      
      <!-- URL一覧とアクセス統計 -->
      <%- include('partials/urls-list', { urls: urls, appDomain: appDomain }) %>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // タブ切り替え
      document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.getAttribute('data-tab');
          
          // タブボタンの状態を更新
          document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
          });
          button.classList.add('active');
          
          // タブパネルの状態を更新
          document.querySelectorAll('.tab-panel').forEach(panel => {
            panel.classList.remove('active');
          });
          document.getElementById(`${tabId}-tab`).classList.add('active');
        });
      });
      
      // コピーボタンの機能追加
      function addCopyButtons() {
        const urlElements = document.querySelectorAll('table td:nth-child(2) a');
        
        urlElements.forEach(element => {
          const url = element.href;
          const copyBtn = document.createElement('button');
          copyBtn.className = 'copy-btn';
          copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
          copyBtn.title = 'URLをコピー';
          
          copyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            navigator.clipboard.writeText(url)
              .then(() => {
                copyBtn.classList.add('copied');
                copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                
                setTimeout(() => {
                  copyBtn.classList.remove('copied');
                  copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
              })
              .catch(err => {
                console.error('コピーに失敗しました:', err);
              });
          });
          
          element.parentNode.appendChild(copyBtn);
        });
      }
      
      // 初期化時にコピーボタンを追加
      addCopyButtons();
    });
  </script>
</body>
</html>